## 概要
このチャットボットは、ポートフォリオサイトの訪問者が「製作者自身のことやスキルについて気軽に質問できる」よう設計しています。FAQの出し分け、キャラクター性、そしてGPT連携など、ユーザー体験を意識した作りにしています。

## 目的
ポートフォリオサイト訪問者（採用担当者など）が、制作者自身のことやスキルについて気軽に質問できる導線として設計

## 全体の仕組み
- 質問方法を「FAQ形式」「自由入力形式」から選択可能
- 自由入力形式では、キャラクター「Earth」が制作者の代わりに応答
- Earthは親しみやすい口調で、閲覧者に合わせた情報提供を行う

## 使用技術
**Frontend**
- React（状態管理、モード切り替え）

**Backend**
- Node.js
- Express（APIエンドポイントの作成）

**Database**
- MySQL（FAQデータ・チャットログの管理）

**外部API**
- Groq API（GPT連携）

## 本番公開構成
このチャットボットはさくらのVPS上に本番環境を構築し、Apacheによるリバースプロキシ設定を通じて React + Node.js アプリを統合的に運用しています。

- **VPS**：さくらのVPS（OS：Rocky Linux）
- **Webサーバ**：Apache（リバースプロキシ設定）
- **フロントエンド**：React（ポート: 3000）
- **バックエンド**：Express / Node.js（ポート: 4000）
- **リバースプロキシ**：Apacheで `/api/` リクエストを Node.js に転送
- **SSL**：Let’s Encrypt でHTTPS対応

## 特徴
**FAQ形式と自由入力形式の切り替え**
  - サイト訪問者が質問スタイルを選べるように設計
  - FAQは階層構造に対応し、段階的に深掘り可能

**キャラクター「Earth」による対話案内**
  - 制作者の代わりに会話形式で案内を行う擬人化キャラ
  - 地球をモチーフとし、親しみやすく優しい口調で応答

**GPT APIとの連携（自由入力形式）**
  - Groq APIを使用して自由入力に対して自然な返答を生成
  - Earthのキャラ設定を活かしたプロンプト構築

**チャットログ保存**
  - 自由入力のやりとりをMySQLに保存し、後から分析可能

## 工夫した点
- コンポーネントと機能ごとに責任範囲を明確にし、将来的なモード追加やキャラクター拡張にも柔軟に対応できる設計を心がけた
- 自由入力形式では、キャラクター設定・プロンプト・表示スタイルの一貫性を持たせ、体験としての自然さを重視した
- コードの見通しや再利用性を高めるために、構造や処理を段階的に整理・改善（リファクタリング）を行った

## 今回あえて実装しなかったこと（優先度を下げたこと）
- FAQの分岐はあえて複雑にせず、構成はシンプルに保っています。
- 自由入力形式のキャラクター（Earth）は、作り込みすぎず、最低限のプロンプトに留めています。
- 一般的な問い合わせ用チャットボットに見られるような「FAQ → エスカレーション」の流れは採用していません。

※これらはすべて、サイト訪問者（特に採用担当者）が短時間で制作者の「実装力」や「構成力」を判断しやすくなるよう意図しています。

## 今後の展望
**自由入力形式の会話ログを活用した、質問傾向の可視化機能**
- DBに保存した `user_message` と `gpt_reply` をもとに、よくある質問のカテゴリや回数を集計
- カテゴリ分類には Groq API による自然言語分類（意図抽出）を活用予定
- 分析結果はチャートライブラリ（例：Chart.js や Recharts）を用いて、以下のような形式で可視化：
  - よくある質問ランキング（棒グラフ）
  - 質問カテゴリごとの比率（円グラフ）
  - 日別の質問回数の推移（折れ線グラフ）
- 採用担当者が関心の高いポイントを客観的に把握し、今後のポートフォリオ改善にも活用予定

**GPT API連携における実行コスト・制限のコントロール**
- 使用するGroq APIには無料プランでの回数制限があるため、以下の制御を検討中：
  - 一定回数以上の送信で自由入力形式を自動停止（現在は手動で切替）
  - `.env` に設定した上限回数に達したかどうかをフロントエンドで判定
- また、将来的にはユーザー行動ログをもとに「GPTで答えなくても良い質問」を識別し、FAQ誘導に切り替えるルール設計も検討中

**関連FAQの表示**
- FAQ機能では、最下層到達時に最初のFAQに戻すだけでなく、関連FAQの提示やルート分岐など、より柔軟なナビゲーションを検討中


## ディレクトリ構成
- `src/`
  - `assets/`：アイコン画像など
  - `chatbot/`：チャットボットのReactコンポーネント群
    - `components/`：UIコンポーネント（ChatBot, MessageList など）
      - `ChatBot.jsx`：チャット全体の親コンポーネント。状態管理とモード切り替えを担当
      - `ChatWindow.jsx`：画面全体のレイアウト、ヘッダーや入力欄などの統合表示を管理
      - `ModeSelect.jsx`：FAQ形式 or 自由入力形式の選択UIを表示
      - `FaqMode.jsx`：FAQ形式における質問表示と選択ボタンの制御を担当
      - `EarthMode.jsx`：自由入力形式におけるメッセージ表示とローディングの制御を担当
      - `MessageList.jsx`：メッセージ配列をループして表示
      - `MessageBubble.jsx`：個別のチャット吹き出しUI
      - `ChatInput.jsx`：テキスト入力欄と送信処理のUI
    - `profiles/`：キャラクター設定（Earthのプロファイル）
    - `api/`：GPT通信・ログ保存などのAPI呼び出し処理
      - `gptRequest.js`：自由入力形式での質問を Groq API に送信し、GPTによる応答を取得
      - `saveChatLog.js`：ユーザーの入力とGPTの応答をサーバーに送信し、MySQLに保存
- `server/`
  - `index.js`：ExpressによるAPIエンドポイント
  - `package.json`：サーバー側依存定義
  - `yarn.lock`：yarn用ロックファイル

## FAQデータベース構成

このチャットボットでは、FAQデータをMySQLで階層的に管理し、関連リンク情報も併せて保持しています。

**faq テーブル**

| カラム名   | 型   | 説明                           |
|------------|------|--------------------------------|
| id         | INT  | 主キー                         |
| parent_id  | INT  | 親FAQのID（NULLなら最上位）   |
| question   | TEXT | 質問文                         |
| answer     | TEXT | 回答文（最下層のみ）          |

**faq_links テーブル**

| カラム名   | 型   | 説明                         |
|------------|------|------------------------------|
| id         | INT  | 主キー                       |
| faq_id     | INT  | 紐付け先のFAQ ID             |
| link_text  | TEXT | 表示するリンクの文言        |
| link_url   | TEXT | 遷移先のURL                  |

この構成により、

- 子FAQの有無に応じた出し分け  
- 回答に関連リンクの提示 （例：ポートフォリオサイト内の作品リンク） 

など、柔軟なFAQナビゲーションが実現されています。  

## ⚠️ 注意事項
- このリポジトリは、ポートフォリオサイトに実装したチャットボット機能のみを抜粋・整理したコードです。
- Reactアプリやサーバー全体の構成を再現するものではなく、単体での実行はできません。
- FAQデータやチャットログ保存のための MySQL データベース、.envファイル（APIキーなど）は含まれていません。


## 🌍補足：なぜ地球？（Why Earth?）

地球はすべての生命の母であり、情報の源でもあります。  
このチャットボットでは、制作者のことをよく知っている"母"のような存在として登場させました。

母親というキャラクターであれば、多少答えがズレていたり、同じ話を繰り返しても、（私の母だけかもしれませんが）
「母親はそういうものかな」と優しく受け止めてもらえるのでは？と考えました。（失礼だったら、ごめんなさい） 

このようにして「技術だけでなく、会話体験としても自然な形」に近づけることを目指しました。
